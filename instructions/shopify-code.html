<script>

  var trackerId = "UA-XXXXX-X";
  var userIdDimensionIndex = 3;

  // Create ga object if not exists
  ga = window.ga = window.ga || function () { (ga.q = ga.q || []).push(arguments) }; ga.l = +new Date;

  ga('create', trackerId, 'auto')

  // Load Dblue Google Analytics Plugin
  ga('require', 'DblueGaPlugin', {
    clientIdDimensionIndex: 1,
    sessionIdDimensionIndex: 2,
    hitIdDimensionIndex: 3,
    hitTimestampDimensionIndex: 4,
    hitTypeDimensionIndex: 5,
    referrerDimensionIndex: 6,
    endpoint: 'https://us-central1-dblue-data-collector.cloudfunctions.net',
  })

  // Set custom dimensions
  ga(function (tracker) {
    var customerId = getShopifyCustomerId();

    if (customerId) {
      ga("set", "dimension" + userIdDimensionIndex, String(customerId));
    }
  });

  function getShopifyCustomerId() {
    try {
      return __st.cid;
    } catch (e) { }

    try {
      return ShopifyAnalytics.meta.page.customerId;
    } catch (e) { }

    try {
      return ShopifyAnalytics.lib.user().traits().uniqToken;
    } catch (e) { }

    return null;
  }

</script>
<script async src="https://storage.googleapis.com/dblue-ga-plugin/1.1.0/dblue-ga-plugin.js"></script>
